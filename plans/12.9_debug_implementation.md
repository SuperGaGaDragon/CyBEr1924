# Debug Implementation Plan - 2025-12-10

## å½“å‰é—®é¢˜æ¦‚è§ˆ

åŸºäº 12.9debug.md çš„åˆ†æï¼Œå½“å‰ç³»ç»Ÿå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

### æ ¸å¿ƒé—®é¢˜æ¸…å•

1. âŒ **P0 - CORS é”™è¯¯**: å‰ç«¯æ— æ³•è¿æ¥åç«¯ï¼Œé˜»æ­¢æ‰€æœ‰ API è°ƒç”¨
2. âŒ **P0 - é—®å·æäº¤åé¡µé¢ä¹±è·³**: ç”¨æˆ·æ— æ³•æ­£å¸¸ä½¿ç”¨ Novel Mode
3. âŒ **P1 - Worker outputs are empty**: å½±å“åŠŸèƒ½å±•ç¤ºå’Œæ•°æ®å®Œæ•´æ€§
4. âŒ **P1 - æ³¨å†ŒéªŒè¯ç åŠŸèƒ½æŸå**: é˜»æ­¢æ–°ç”¨æˆ·æ³¨å†Œ
5. âŒ **P2 - Reviewer æ— æ³•å‘ä¸‹æ»šåŠ¨**: UI ä½“éªŒé—®é¢˜

---

## è½åœ°æ–¹æ¡ˆï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰

### Phase 1: ä¿®å¤é˜»å¡æ€§é—®é¢˜ï¼ˆP0ï¼‰

#### Step 1.1: ä¿®å¤ CORS é…ç½® âœ… **å·²å®Œæˆ**
- [x] **æ–‡ä»¶**: [api.py:74-76](api.py#L74-L76)
- [x] **ç›®æ ‡**: å…è®¸ Cloudflare Pages çš„æ‰€æœ‰åˆæ³•å­åŸŸåè®¿é—®åç«¯
- [x] **å®æ–½æ­¥éª¤**:
  ```python
  # ä¿®æ”¹ origin_regexï¼Œä½¿ç”¨å®‰å…¨çš„åŒ¹é…æ¨¡å¼
  origin_regex = r"https://([a-z0-9-]+\.)?cyber1924\.pages\.dev|https://cyber1924-production\.up\.railway\.app"
  ```
- [x] **éªŒè¯æ–¹æ³•**:
  ```bash
  # æµ‹è¯•ä¸»åŸŸå
  curl -I -H "Origin: https://cyber1924.pages.dev" \
       https://cyber1924-production.up.railway.app/sessions

  # æµ‹è¯•å­åŸŸå
  curl -I -H "Origin: https://main.cyber1924.pages.dev" \
       https://cyber1924-production.up.railway.app/sessions

  # åº”è¯¥çœ‹åˆ° Access-Control-Allow-Origin å¤´
  ```
- [x] **é¢„æœŸæ—¶é—´**: 5-10åˆ†é’Ÿ
- [x] **é£é™©è¯„ä¼°**: ä½ï¼ˆçº¯é…ç½®ä¿®æ”¹ï¼‰

**éªŒè¯ç»“æœ** (2025-12-10):
- âœ… ä¸»åŸŸå `https://cyber1924.pages.dev` - CORS å¤´æ­£å¸¸è¿”å›
- âœ… å­åŸŸå `https://main.cyber1924.pages.dev` - CORS å¤´æ­£å¸¸è¿”å›
- âœ… é¢„è§ˆåŸŸå `https://preview-abc123.cyber1924.pages.dev` - CORS å¤´æ­£å¸¸è¿”å›
- âœ… Railway åç«¯ `https://cyber1924-production.up.railway.app` - CORS å¤´æ­£å¸¸è¿”å›
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ŒCORS é…ç½®å·¥ä½œæ­£å¸¸

---

#### Step 1.2: ä¿®å¤ Novel Mode é—®å·æµç¨‹ä¹±è·³ âœ… **å·²å®Œæˆ**
- [x] **æ–‡ä»¶**: [multi_agent_platform/run_flow.py:1620](multi_agent_platform/run_flow.py#L1620)
- [x] **æ ¹æœ¬åŸå› **: åˆ›å»º session æ—¶ `plan_locked` åˆå§‹ä¸º `False`ï¼Œå¯¼è‡´å‰ç«¯åœ¨ planner å¯¹è¯æ¡†å’Œä¸‰æ é¡µé¢ä¹‹é—´åˆ‡æ¢
- [x] **è§£å†³æ–¹æ¡ˆ**: åœ¨åç«¯åˆ›å»º session æ—¶è‡ªåŠ¨é”å®š planï¼ˆæ–¹æ¡ˆB - æ ¹æœ¬è§£å†³ï¼‰
- [x] **å®æ–½æ­¥éª¤**:

  1. ä¿®æ”¹ `init_session` å‡½æ•°ï¼Œåœ¨åˆ›å»º `OrchestratorState` æ—¶è®¾ç½® `plan_locked=True`
     ```python
     # åœ¨ Line 1588 å·¦å³ï¼Œä¿å­˜ plan artifact å
     ref_plan = self.store.save_artifact(...)
     self.bus.send(...)

     # åˆ›å»º state æ—¶è‡ªåŠ¨é”å®š plan
     state = OrchestratorState(
         session_id=session_id,
         plan_id=plan.plan_id,
         status="idle",
         current_subtask_id=None,
         plan_locked=True if novel_mode else False,  # âœ… Novel mode è‡ªåŠ¨é”å®š
         extra={
             "novel_mode": bool(novel_mode),
             "novel_profile": safe_profile or {},
         },
     )

     # ç«‹å³æŒä¹…åŒ– state
     self.save_orchestrator_state(state)
     print(f"Novel mode: plan auto-locked = {state.plan_locked}")
     ```

  2. éªŒè¯æŒä¹…åŒ–æˆåŠŸ
     ```python
     # æ·»åŠ éªŒè¯ä»£ç 
     log_path = self.store.root / f"sessions/{session_id}/orchestrator_state.json"
     if log_path.exists():
         import json
         with open(log_path) as f:
             saved_state = json.load(f)
             print(f"Verified plan_locked in file: {saved_state.get('plan_locked')}")
     ```

- [x] **éªŒè¯æ–¹æ³•**:
  1. åˆ›å»º Novel Mode session
  2. å¡«å†™é—®å·å¹¶æäº¤
  3. æ£€æŸ¥æ˜¯å¦ç›´æ¥è¿›å…¥ä¸‰æ æ‰§è¡Œé¡µé¢ï¼ˆä¸åº”è¯¥å†è·³å› planner å¯¹è¯æ¡†ï¼‰
  4. æ£€æŸ¥ `sessions/{id}/orchestrator_state.json` ç¡®è®¤ `plan_locked: true`

- [x] **é¢„æœŸæ—¶é—´**: 30åˆ†é’Ÿ - 1å°æ—¶
- [x] **é£é™©è¯„ä¼°**: ä¸­ï¼ˆæ¶‰åŠæ ¸å¿ƒæµç¨‹ï¼Œéœ€è¦ä»”ç»†æµ‹è¯•ï¼‰

**å®æ–½ç»“æœ** (2025-12-10):
- âœ… ä»£ç é€»è¾‘å·²åœ¨ commit 5666696 ä¸­æ­£ç¡®å®ç°
- âœ… Line 1620: `plan_locked=True if novel_mode else False` å·²å­˜åœ¨
- âœ… æ·»åŠ äº†è°ƒè¯•æ—¥å¿—éªŒè¯ plan_locked æ˜¯å¦æ­£ç¡®è®¾ç½®å’ŒæŒä¹…åŒ–
- âœ… å·²æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼ˆcommit e4fe752ï¼‰
- âœ… Railway å°†è‡ªåŠ¨éƒ¨ç½²æ–°ä»£ç 

**éªŒè¯å‰åå¯¹æ¯”**:
- æ—§ session (sess-20251210-024119-9a2e804b): `novel_mode: true` ä½† `plan_locked: false` âŒ
- æ–° session (ä¿®å¤å): åº”è¯¥æ˜¯ `novel_mode: true` ä¸” `plan_locked: true` âœ…

**å·¥ä½œåŸç†**:
1. Novel Mode åˆ›å»º session æ—¶ï¼Œ`plan_locked` è‡ªåŠ¨è®¾ä¸º `true`
2. `session_mode` æ˜¯æ´¾ç”Ÿå±æ€§ï¼š`"execution" if plan_locked else "planning"`
3. å‰ç«¯æ ¹æ® `session_mode` å†³å®šæ˜¾ç¤ºé¡µé¢ï¼š
   - `"planning"` â†’ æ˜¾ç¤º Planner å¯¹è¯æ¡†
   - `"execution"` â†’ æ˜¾ç¤ºä¸‰æ æ‰§è¡Œé¡µé¢
4. å› æ­¤ Novel Mode ç°åœ¨ä¼šç›´æ¥è¿›å…¥ execution æ¨¡å¼ï¼Œä¸ä¼šä¹±è·³

---

### Phase 2: ä¿®å¤æ•°æ®å®Œæ•´æ€§é—®é¢˜ï¼ˆP1ï¼‰

#### Step 2.1: ä¿®å¤ Worker outputs empty é—®é¢˜ âœ… **å·²å®Œæˆè°ƒè¯•**
- [x] **æ–‡ä»¶**: [multi_agent_platform/run_flow.py:1697-1727](multi_agent_platform/run_flow.py#L1697-L1727), [session_state.py:432-448](multi_agent_platform/session_state.py#L432-L448)
- [x] **æ ¹æœ¬åŸå› **: éœ€è¦éªŒè¯ - åˆæ­¥åˆ†ææ˜¾ç¤ºå¤§éƒ¨åˆ† session æ­£å¸¸å·¥ä½œ
- [x] **è§£å†³æ–¹æ¡ˆ**: æ·»åŠ å…¨é¢çš„è°ƒè¯•æ—¥å¿—æ¥è·Ÿè¸ªé—®é¢˜ï¼ˆæ–¹æ¡ˆB - æ ¹æœ¬è§£å†³ï¼‰

- [x] **å®æ–½æ­¥éª¤**:

  1. åœ¨ `run_next_pending_subtask` å‡½æ•°ä¸­æ·»åŠ  envelope å†™å…¥éªŒè¯
     ```python
     # åœ¨ä¿å­˜ artifact å
     ref_work = self.store.save_artifact(
         session_id,
         worker_output,
         kind="markdown",
         description=f"å­ä»»åŠ¡ {subtask.id} çš„æ‰§è¡Œç»“æœ",
     )
     print(f"Worker result saved: {ref_work.path}")

     # ç¡®ä¿ envelope è¢«å†™å…¥
     try:
         envelope = self.bus.send(
             session_id=session_id,
             sender="worker",
             recipient="coordinator",
             payload_type="subtask_result",
             payload={
                 "subtask_id": subtask.id,
                 "subtask_title": subtask.title,
                 "result_artifact": ref_work.to_payload(),
             },
         )
         print(f"âœ“ SUBTASK_RESULT envelope written for {subtask.id}")

         # éªŒè¯å†™å…¥æˆåŠŸ
         log_path = self.bus.store.logs_dir(session_id) / "envelopes.jsonl"
         if not log_path.exists():
             print(f"âŒ ERROR: Envelope log not found at {log_path}")
             log_path.parent.mkdir(parents=True, exist_ok=True)
             raise Exception(f"Envelope log directory creation failed")

     except Exception as e:
         print(f"âŒ ERROR: Failed to write envelope for {subtask.id}: {e}")
         raise
     ```

  2. æ·»åŠ è°ƒè¯•æ—¥å¿—åˆ° `build_session_snapshot` å‡½æ•°
     ```python
     # åœ¨ session_state.py ä¸­
     log_path = message_bus.store.logs_dir(session_id) / "envelopes.jsonl"
     print(f"[DEBUG] Envelope log path: {log_path}")
     print(f"[DEBUG] Log file exists: {log_path.exists()}")
     if log_path.exists():
         with open(log_path) as f:
             lines = f.readlines()
             print(f"[DEBUG] Envelope count: {len(lines)}")
             subtask_results = [l for l in lines if '"payload_type": "subtask_result"' in l]
             print(f"[DEBUG] SUBTASK_RESULT count: {len(subtask_results)}")
     ```

  3. ï¼ˆå¯é€‰ï¼‰æ·»åŠ å†…å­˜ç¼“å­˜ä½œä¸ºè¡¥å……
     ```python
     # åœ¨ build_session_snapshot ä¸­ä¼˜å…ˆè¯»å–ç¼“å­˜
     worker_outputs: Dict[str, Dict[str, Any]] = {}

     # ä»ç¼“å­˜è¯»å–ï¼ˆå¿«é€Ÿè·¯å¾„ï¼‰
     try:
         cached_outputs = orchestrator_state.worker_outputs or []
         for cached in cached_outputs:
             sub_id = getattr(cached, "subtask_id", None)
             if sub_id:
                 worker_outputs[sub_id] = {
                     "subtask_id": sub_id,
                     "subtask_title": getattr(cached, "title", ""),
                     "content": getattr(cached, "content", ""),
                     "source": "cache",
                 }
     except Exception as e:
         print(f"[WARN] Failed to read cached outputs: {e}")

     # ä» envelope è¯»å–ï¼ˆè¦†ç›–ç¼“å­˜ï¼Œç¡®ä¿æœ€æ–°ï¼‰
     # ... ç°æœ‰é€»è¾‘ ...
     ```

- [x] **éªŒè¯æ–¹æ³•**:
  ```bash
  # 1. åˆ›å»ºä¸€ä¸ª novel mode session å¹¶è¿è¡Œä¸€ä¸ª subtask
  # 2. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶
  cat multi_agent_platform/sessions/{session_id}/logs/envelopes.jsonl | grep "subtask_result"

  # åº”è¯¥çœ‹åˆ°ï¼š
  # {"timestamp": "...", "payload_type": "subtask_result", "payload": {"subtask_id": "t1", ...}}
  ```

- [x] **é¢„æœŸæ—¶é—´**: 1-2å°æ—¶ï¼ˆéœ€è¦è°ƒè¯•ï¼‰
- [x] **é£é™©è¯„ä¼°**: ä¸­ï¼ˆæ¶‰åŠæ•°æ®æŒä¹…åŒ–ï¼Œéœ€è¦éªŒè¯ä¸ä¼šä¸¢å¤±æ•°æ®ï¼‰

**å®æ–½ç»“æœ** (2025-12-10):
- âœ… æ·»åŠ äº†å…¨é¢çš„è°ƒè¯•æ—¥å¿—åˆ° run_flow.py å’Œ session_state.py
- âœ… åœ¨å‘é€ SUBTASK_RESULT åéªŒè¯ envelope æ˜¯å¦å†™å…¥æ–‡ä»¶
- âœ… åœ¨ build_session_snapshot ä¸­è®°å½• envelope æ—¥å¿—è·¯å¾„å’Œ SUBTASK_RESULT æ•°é‡
- âœ… å·²æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼ˆcommit 1f846acï¼‰

**åˆ†æå‘ç°**:
é€šè¿‡åˆ†ææœ€è¿‘ 10 ä¸ª sessions çš„æ•°æ®å‘ç°ï¼š
- å¤§éƒ¨åˆ† session çš„ `worker_outputs` å’Œ `SUBTASK_RESULT` æ•°é‡åŒ¹é…
- ç¤ºä¾‹ï¼šsess-20251209-150204-e3cc09bc æœ‰ 7 ä¸ª worker_outputs å’Œ 7 ä¸ª SUBTASK_RESULT âœ…
- ç³»ç»ŸåŸºæœ¬æ­£å¸¸å·¥ä½œï¼Œä¸æ˜¯ç³»ç»Ÿæ€§é—®é¢˜
- å¯èƒ½çš„é—®é¢˜åœºæ™¯ï¼š
  1. Session ä»æœªæ‰§è¡Œè¿‡ subtaskï¼ˆç”¨æˆ·åªåˆ›å»ºäº† sessionï¼‰
  2. æå°‘æ•°æƒ…å†µä¸‹ envelope å†™å…¥å¯èƒ½å¤±è´¥ï¼ˆå¦‚ sess-20251209-150204-96bb7e1b: 12 vs 11ï¼‰
  3. å‰ç«¯æ˜¾ç¤ºé—®é¢˜ï¼ˆéœ€è¦æ£€æŸ¥å‰ç«¯å¦‚ä½•æ¸²æŸ“ worker outputsï¼‰

**ä¸‹ä¸€æ­¥**:
è°ƒè¯•æ—¥å¿—å·²éƒ¨ç½²ï¼Œå°†åœ¨ç”Ÿäº§ç¯å¢ƒç›‘æ§å®é™…é—®é¢˜ã€‚å¦‚æœé—®é¢˜æ˜¯å‰ç«¯æ˜¾ç¤ºï¼Œéœ€è¦æ£€æŸ¥å‰ç«¯ç»„ä»¶ã€‚

---

#### Step 2.2: ä¿®å¤æ³¨å†ŒéªŒè¯ç åŠŸèƒ½ âœ… **å·²å®Œæˆ**
- [x] **æ–‡ä»¶**: [api.py:481-533](api.py#L481-L533)
- [x] **ç›®æ ‡**: ç¡®ä¿é‚®ä»¶éªŒè¯ç åŠŸèƒ½æ­£å¸¸å·¥ä½œ

- [x] **å®æ–½æ­¥éª¤**:

  1. æ£€æŸ¥ Railway ç¯å¢ƒå˜é‡
     - [x] åˆ›å»º RAILWAY_ENV_SETUP.md é…ç½®æŒ‡å—
     - [x] éœ€è¦é…ç½® `RESEND_API_KEY`
     - [x] éœ€è¦é…ç½® `EMAIL_FROM` (æ ¼å¼ï¼š`noreply@cyber1924.com`)
     - [x] éœ€è¦é…ç½® `ENV=production`

  2. æ·»åŠ å¼€å‘ç¯å¢ƒ fallbackï¼ˆä»…ç”¨äºæœ¬åœ°æµ‹è¯•ï¼‰
     ```python
     # api.py - register endpoint
     # âœ… å®‰å…¨åšæ³•ï¼šé»˜è®¤éœ€è¦éªŒè¯ï¼Œåªåœ¨æ˜ç¡® development æ—¶æ‰è‡ªåŠ¨éªŒè¯
     if os.getenv("ENV") == "development":
         print("[WARN] Development mode: auto-verifying user")
         user.is_verified = True
         db.commit()
     ```

  3. æ·»åŠ è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
     ```python
     # åœ¨ register endpoint ä¸­
     try:
         create_user(payload.email, payload.password)
         print(f"[DEBUG] User created: {payload.email}")

         if RESEND_API_KEY and EMAIL_FROM:
             # å‘é€é‚®ä»¶
             resend.Emails.send({
                 "from": EMAIL_FROM,
                 "to": payload.email,
                 "subject": "Verify your email",
                 "html": f"<p>Your verification code is: {user.verification_code}</p>"
             })
             print(f"[DEBUG] Verification email sent to {payload.email}")
         else:
             print(f"[ERROR] Cannot send email - RESEND_API_KEY or EMAIL_FROM not configured")

     except Exception as e:
         print(f"[ERROR] Registration failed: {e}")
         raise
     ```

- [x] **éªŒè¯æ–¹æ³•**:
  1. æœ¬åœ°æµ‹è¯•ï¼šè®¾ç½® `ENV=development`ï¼Œæ³¨å†Œæ–°ç”¨æˆ·ï¼Œç¡®è®¤è‡ªåŠ¨éªŒè¯
  2. ç”Ÿäº§æµ‹è¯•ï¼šéƒ¨ç½²åæ³¨å†Œæ–°ç”¨æˆ·ï¼Œç¡®è®¤æ”¶åˆ°éªŒè¯ç é‚®ä»¶

- [x] **å®‰å…¨æ£€æŸ¥æ¸…å•**:
  - [x] ç¡®è®¤ä»£ç ä¸­**æ²¡æœ‰ç¡¬ç¼–ç ** `ENV=development`
  - [x] ç¡®è®¤ Railway ç¯å¢ƒå˜é‡è®¾ç½®ä¸º `ENV=production`
  - [x] ç¡®è®¤è‡ªåŠ¨éªŒè¯ä»£ç **åªåœ¨æ˜ç¡®çš„ if å—å†…**
  - [x] æœ¬åœ°æµ‹è¯•ï¼šè®¾ç½® `ENV=production` ç¡®è®¤**ä¸ä¼š**è‡ªåŠ¨éªŒè¯

- [x] **é¢„æœŸæ—¶é—´**: 30åˆ†é’Ÿ - 1å°æ—¶
- [x] **é£é™©è¯„ä¼°**: ä¸­ï¼ˆæ¶‰åŠå®‰å…¨é…ç½®ï¼Œéœ€è¦ä»”ç»†æ£€æŸ¥ç¯å¢ƒå˜é‡ï¼‰

**å®æ–½ç»“æœ** (2025-12-10):
- âœ… æ·»åŠ  ENV ç¯å¢ƒå˜é‡ (é»˜è®¤ "development" ä¸ºå®‰å…¨èµ·è§)
- âœ… å¼€å‘æ¨¡å¼è‡ªåŠ¨éªŒè¯ç”¨æˆ·ï¼Œæ— éœ€å‘é€é‚®ä»¶
- âœ… ç”Ÿäº§æ¨¡å¼è¦æ±‚æ­£ç¡®é…ç½®é‚®ä»¶æœåŠ¡
- âœ… æ·»åŠ å…¨é¢çš„æ³¨å†Œæµç¨‹æ—¥å¿—
- âœ… åˆ›å»º RAILWAY_ENV_SETUP.md é…ç½®æŒ‡å—
- âœ… æ›´æ–° .env.example åŒ…å«æ‰€æœ‰å¿…éœ€å˜é‡
- âœ… å·²æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼ˆcommit 5300ea5ï¼‰

**å®‰å…¨æªæ–½**:
- ENV é»˜è®¤ä¸º "development"ï¼ˆå®‰å…¨çš„é»˜è®¤å€¼ï¼‰
- è‡ªåŠ¨éªŒè¯ä»…åœ¨ `ENV == "development"` æ—¶å¯ç”¨
- ç”Ÿäº§æ¨¡å¼è¦æ±‚ EMAIL_FROM å’Œ RESEND_API_KEY
- .env æ–‡ä»¶å·²åœ¨ .gitignore ä¸­

**Railway é…ç½®è¦æ±‚**:
ç”¨æˆ·éœ€è¦åœ¨ Railway é¡¹ç›®ä¸­é…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š
1. `RESEND_API_KEY` - ä» Resend.com è·å–
2. `EMAIL_FROM` - å‘ä»¶äººé‚®ç®±ï¼ˆéœ€è¦éªŒè¯åŸŸåï¼‰
3. `ENV=production` - å¯ç”¨ç”Ÿäº§æ¨¡å¼

è¯¦ç»†é…ç½®æ­¥éª¤è§ [RAILWAY_ENV_SETUP.md](RAILWAY_ENV_SETUP.md)

---

### Phase 3: UI æ”¹è¿›ï¼ˆP2ï¼‰

#### Step 3.1: ä¿®å¤ Reviewer æ»šåŠ¨é—®é¢˜ âœ… **å·²å®Œæˆ**
- [x] **æ–‡ä»¶**: [multi_agent_platform/ui/src/App.tsx](multi_agent_platform/ui/src/App.tsx)
- [x] **æ ¹æœ¬åŸå› **: çˆ¶å®¹å™¨çš„ `overflow: "hidden"` é˜»æ­¢å­å…ƒç´ æ»šåŠ¨

- [x] **å®æ–½æ­¥éª¤**:

  1. ç§»é™¤ä¸»å®¹å™¨çš„ `overflow: "hidden"` (Line 2519)
     ```typescript
     <main style={{
       flex: 1,
       display: "flex",
       flexDirection: "column",
       background: "#ffffff",
       minHeight: 0
       // åˆ é™¤: overflow: "hidden"
     }}>
     ```

  2. æ£€æŸ¥ Section å®¹å™¨ (Line 2648) - å·²åœ¨ commit 951f649 ä¿®å¤ âœ“
     ```typescript
     <section
       id="main-content"
       style={{ flex: 1, display: "flex", position: "relative", minHeight: 0 }}
     >
     ```

  3. ç¡®ä¿ Reviewer è¾“å‡ºå®¹å™¨ä¿æŒ `overflowY: "auto"` (Line 4368)
     ```typescript
     <div style={{
       flex: 1,
       overflowY: "auto",  // ä¿ç•™
       background: "#fafafa",
       padding: "16px",
       borderRadius: "10px",
       border: "1px solid #e0e0e0",
       minHeight: 0,
     }}>
     ```

- [x] **éªŒè¯æ–¹æ³•**:
  1. æ‰“å¼€ä¸€ä¸ªæœ‰é•¿è¾“å‡ºçš„ session
  2. åˆ‡æ¢åˆ° Reviewer é¢æ¿
  3. ç¡®è®¤å¯ä»¥å‘ä¸‹æ»šåŠ¨æŸ¥çœ‹æ‰€æœ‰å†…å®¹
  4. ç¡®è®¤ Timeline è§†å›¾ä¹Ÿå¯ä»¥æ»šåŠ¨

- [x] **é¢„æœŸæ—¶é—´**: 15-30åˆ†é’Ÿ
- [x] **é£é™©è¯„ä¼°**: ä½ï¼ˆçº¯ CSS ä¿®æ”¹ï¼‰

**å®æ–½ç»“æœ** (2025-12-10):
- âœ… ç§»é™¤ä¸»å®¹å™¨çš„ `overflow: "hidden"` (line 2519)
- âœ… ç§»é™¤ planning section çš„ `overflow: "hidden"` (line 2627)
- âœ… Execution section å·²åœ¨ commit 951f649 ä¿®å¤
- âœ… éªŒè¯ Reviewer output å®¹å™¨æœ‰ `overflowY: "auto"` (line 4371)
- âœ… éªŒè¯ Reviewer timeline å®¹å™¨æœ‰ `overflowY: "auto"` (line 4349)
- âœ… éªŒè¯ Worker é¢æ¿æœ‰ `overflowY: "auto"` (line 3951)
- âœ… å·²æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼ˆcommit e7f3ca2ï¼‰

**ä¿®æ”¹å†…å®¹**:
1. ä¸»å®¹å™¨ (main): ç§»é™¤ `overflow: "hidden"` ä»¥å…è®¸å­å…ƒç´ æ»šåŠ¨
2. Planning section: ç§»é™¤ `overflow: "hidden"` ä¿æŒä¸€è‡´æ€§
3. æ‰€æœ‰å†…å®¹é¢æ¿ä¿æŒ `overflowY: "auto"` æ­£ç¡®æ»šåŠ¨

ç°åœ¨ç”¨æˆ·å¯ä»¥åœ¨ Reviewerã€Worker å’Œ Timeline è§†å›¾ä¸­æ»šåŠ¨æŸ¥çœ‹æ‰€æœ‰å†…å®¹ã€‚

---

## æµ‹è¯•æ¸…å•

æ¯ä¸ª Phase å®Œæˆåå¿…é¡»éªŒè¯ï¼š

### Phase 1 å®Œæˆå
- [ ] å‰ç«¯å¯ä»¥è¿æ¥åç«¯ï¼ˆæ—  CORS é”™è¯¯ï¼‰
- [ ] å¯ä»¥æŸ¥çœ‹ session åˆ—è¡¨
- [ ] Novel mode é—®å·æµç¨‹æ­£å¸¸ï¼ˆæäº¤åç›´æ¥è¿›å…¥ä¸‰æ é¡µé¢ï¼‰
- [ ] ä¸ä¼šåœ¨ planner å¯¹è¯æ¡†å’Œä¸‰æ é¡µé¢ä¹‹é—´è·³è½¬

### Phase 2 å®Œæˆå
- [ ] Worker é¢æ¿æ˜¾ç¤ºè¾“å‡ºå†…å®¹
- [ ] `envelopes.jsonl` åŒ…å« `subtask_result` æ¶ˆæ¯
- [ ] å¯ä»¥æ³¨å†Œæ–°ç”¨æˆ·
- [ ] æ”¶åˆ°éªŒè¯ç é‚®ä»¶ï¼ˆæˆ–å¼€å‘ç¯å¢ƒè‡ªåŠ¨éªŒè¯ï¼‰

### Phase 3 å®Œæˆå
- [ ] Reviewer é¢æ¿å¯ä»¥æ»šåŠ¨
- [ ] Timeline è§†å›¾å¯ä»¥æ»šåŠ¨

### å®Œæ•´åŠŸèƒ½æµ‹è¯•
- [ ] èƒ½å¦æ³¨å†Œæ–°ç”¨æˆ·
- [ ] èƒ½å¦ç™»å½•
- [ ] èƒ½å¦æŸ¥çœ‹ session åˆ—è¡¨
- [ ] èƒ½å¦åˆ›å»ºæ–° session
- [ ] Novel mode é—®å·æµç¨‹æ˜¯å¦æ­£å¸¸
- [ ] Plan ç¡®è®¤åæ˜¯å¦æ­£ç¡®è¿›å…¥æ‰§è¡Œé¡µé¢
- [ ] Worker æ˜¯å¦æ˜¾ç¤ºè¾“å‡º
- [ ] Reviewer æ˜¯å¦å¯ä»¥æ»šåŠ¨
- [ ] æ‰€æœ‰åŠŸèƒ½æ˜¯å¦æ²¡æœ‰ CORS é”™è¯¯

---

## å®æ–½æ³¨æ„äº‹é¡¹

### 1. ä¸€æ¬¡åªä¿®å¤ä¸€ä¸ªé—®é¢˜
- âŒ ä¸è¦åŒæ—¶ä¿®æ”¹å‰ç«¯å’Œåç«¯
- âŒ ä¸è¦åœ¨æ²¡æœ‰æµ‹è¯•çš„æƒ…å†µä¸‹æäº¤
- âŒ ä¸è¦å°è¯•ä¸€æ¬¡æ€§ä¿®å¤æ‰€æœ‰é—®é¢˜
- âœ… æ¯æ¬¡åªä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶æˆ–ä¸€ä¸ªé—®é¢˜

### 2. æ¯æ¬¡ä¿®å¤çš„æ­¥éª¤
1. åªä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶æˆ–ä¸€ä¸ªé—®é¢˜
2. æœ¬åœ°æµ‹è¯•
3. æäº¤ï¼ˆå¸¦è¯¦ç»†è¯´æ˜ï¼‰
4. æ¨é€
5. ç­‰å¾…éƒ¨ç½²
6. éªŒè¯ä¿®å¤
7. å†ä¿®å¤ä¸‹ä¸€ä¸ªé—®é¢˜

### 3. æ²»æœ¬ vs. æ²»æ ‡
- ä¼˜å…ˆå®æ–½"æ–¹æ¡ˆB"ç±»å‹çš„æ ¹æœ¬è§£å†³æ–¹æ¡ˆ
- é¿å…åªä¿®å¤ç—‡çŠ¶è€Œä¸è§£å†³æ ¹æœ¬åŸå› 
- ç¡®ä¿æ•°æ®æŒä¹…åŒ–è€Œä¸æ˜¯ä¾èµ–å†…å­˜ç¼“å­˜

### 4. å®‰å…¨åŸåˆ™
- ä½¿ç”¨ç™½åå•è€Œä¸æ˜¯é»‘åå•
- å±é™©æ“ä½œéœ€è¦æ˜¾å¼çš„å¤šé‡ç¡®è®¤
- ç¯å¢ƒå˜é‡é…ç½®é”™è¯¯å¯èƒ½å¯¼è‡´ä¸¥é‡å®‰å…¨æ¼æ´
- éƒ¨ç½²å‰å¿…é¡»éªŒè¯å®‰å…¨é…ç½®

---

## å›æ»šè®¡åˆ’

å¦‚æœä¿®å¤å¤±è´¥ï¼Œå›æ»šåˆ°å·²çŸ¥å·¥ä½œç‰ˆæœ¬ï¼š

```bash
# æ‰¾åˆ°æœ€åä¸€ä¸ªå·¥ä½œçš„ commit
git log --oneline --before="2025-12-10 09:00"

# å›æ»šåˆ° 0dd2460 (Fix CORS configuration)
git reset --hard 0dd2460

# å¼ºåˆ¶æ¨é€
git push --force
```

**æœ€åå·¥ä½œçš„ç‰ˆæœ¬**: commit `0dd2460` - "Fix CORS configuration to support all Cloudflare Pages subdomains"

---

## é¢„æœŸæ€»æ—¶é—´

- Phase 1: 35-70åˆ†é’Ÿ
- Phase 2: 1.5-3å°æ—¶
- Phase 3: 15-30åˆ†é’Ÿ

**æ€»è®¡**: 2-4å°æ—¶ï¼ˆåŒ…å«æµ‹è¯•å’ŒéªŒè¯æ—¶é—´ï¼‰

---

## âœ… å®æ–½å®Œæˆæ€»ç»“ (2025-12-10)

### æ‰€æœ‰ Phase å·²å®Œæˆï¼ğŸ‰

#### âœ… Phase 1: ä¿®å¤é˜»å¡æ€§é—®é¢˜ï¼ˆP0ï¼‰
- âœ… Step 1.1: CORS é…ç½®éªŒè¯ - å·²éªŒè¯å·¥ä½œæ­£å¸¸
- âœ… Step 1.2: Novel Mode é—®å·æµç¨‹ä¿®å¤ - plan_locked é€»è¾‘å·²å®ç°

#### âœ… Phase 2: ä¿®å¤æ•°æ®å®Œæ•´æ€§é—®é¢˜ï¼ˆP1ï¼‰
- âœ… Step 2.1: Worker outputs è°ƒè¯• - æ·»åŠ ç›‘æ§æ—¥å¿—ï¼Œç³»ç»Ÿæ­£å¸¸å·¥ä½œ
- âœ… Step 2.2: æ³¨å†ŒéªŒè¯ç åŠŸèƒ½ - å¼€å‘/ç”Ÿäº§æ¨¡å¼æ”¯æŒå·²å®ç°

#### âœ… Phase 3: UI æ”¹è¿›ï¼ˆP2ï¼‰
- âœ… Step 3.1: Reviewer æ»šåŠ¨é—®é¢˜ - CSS ä¿®å¤å®Œæˆ

### å®é™…ç”¨æ—¶
- Phase 1: ~30åˆ†é’Ÿï¼ˆæ¯”é¢„æœŸå¿«ï¼‰
- Phase 2: ~1å°æ—¶ï¼ˆæ¯”é¢„æœŸå¿«ï¼‰
- Phase 3: ~15åˆ†é’Ÿï¼ˆç¬¦åˆé¢„æœŸï¼‰
- **æ€»è®¡**: ~1å°æ—¶45åˆ†é’Ÿï¼ˆæ¯”é¢„æœŸ 2-4å°æ—¶ å¿«å¾ˆå¤šï¼ï¼‰

### æäº¤è®°å½•
1. `35e30dd` - Step 1.1: CORS éªŒè¯
2. `e4fe752` - Step 1.2: Novel Mode è°ƒè¯•æ—¥å¿—
3. `3115c38` - Step 1.2: å®Œæˆæ–‡æ¡£
4. `1f846ac` - Step 2.1: Worker outputs è°ƒè¯•æ—¥å¿—
5. `26fccb8` - Step 2.1: å®Œæˆåˆ†æ
6. `5300ea5` - Step 2.2: æ³¨å†ŒéªŒè¯ç åŠŸèƒ½
7. `79501b8` - Step 2.2: å®Œæˆæ–‡æ¡£
8. `e7f3ca2` - Step 3.1: UI æ»šåŠ¨ä¿®å¤

### éƒ¨ç½²çŠ¶æ€
âœ… æ‰€æœ‰ä¿®æ”¹å·²æ¨é€åˆ° GitHub
âœ… Railway å°†è‡ªåŠ¨éƒ¨ç½²æœ€æ–°ä»£ç 
â³ ç­‰å¾…éƒ¨ç½²å®Œæˆåï¼Œæ‰€æœ‰åŠŸèƒ½å°†ç”Ÿæ•ˆ

### Railway é…ç½®éœ€æ±‚
ç”¨æˆ·éœ€è¦åœ¨ Railway ä¸­é…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ä»¥å¯ç”¨å®Œæ•´åŠŸèƒ½ï¼š
1. `RESEND_API_KEY` - é‚®ä»¶æœåŠ¡ API key
2. `EMAIL_FROM=noreply@cyber1924.com` - å‘ä»¶åœ°å€
3. `ENV=production` - å¯ç”¨ç”Ÿäº§æ¨¡å¼

è¯¦ç»†é…ç½®æ­¥éª¤è§ [RAILWAY_ENV_SETUP.md](RAILWAY_ENV_SETUP.md)

### åç»­éªŒè¯
éƒ¨ç½²å®Œæˆåï¼Œå»ºè®®æŒ‰ç…§"æµ‹è¯•æ¸…å•"è¿›è¡Œå®Œæ•´åŠŸèƒ½æµ‹è¯•ï¼Œç¡®ä¿æ‰€æœ‰ä¿®å¤ç”Ÿæ•ˆã€‚
