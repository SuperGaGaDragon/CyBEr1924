** to do list **
- debug
- åç«¯ uiåŒæ­¥ã€‚ï¼ˆç”Ÿæˆä»€ä¹ˆuiæ˜¾ç¤ºä»€ä¹ˆï¼‰
- uiå†…å®¹æ— æ³•æ˜¾ç¤ºåˆ°å‰ç«¯é—®é¢˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ é—®é¢˜è¯Šæ–­ä¸åˆ†æ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

** å…·ä½“é—®é¢˜å®šä½ **

=== é—®é¢˜ 1: Log æ··ä¹±è¾“å‡º Bug ===
æ ¹æ®logï¼Œå¯ä»¥çœ‹åˆ°ä»¥ä¸‹æ··ä¹±ï¼š
- ç¬¬105è¡Œï¼š`å°è¯´æ ‡é¢˜ï¼š3030` å’Œ `ä½“è£ï¼šç§‘å¹»çŸ­ç¯‡` æ··åœ¨äº†ç« èŠ‚åˆ†é…çš„æ—¥å¿—ä¸­
- ç¬¬107è¡Œï¼š`ç« èŠ‚å®‰æ’ï¼š` åç´§è·Ÿç€ `- ç±»å‹ï¼šæœåŠ¡å‹æ™ºèƒ½æœºå™¨äºº`ï¼ˆè¿™åº”è¯¥æ˜¯t2çš„å†…å®¹ï¼‰
- ç¬¬109-113è¡Œï¼št4çš„å†…å®¹å’Œt2çš„å†…å®¹æ··åœ¨ä¸€èµ·

é—®é¢˜åŸå› ï¼š
1. **å¹¶å‘è¾“å‡ºå¯¼è‡´äº¤é”™**ï¼šå¤šä¸ªagentå¹¶å‘è¿è¡Œæ—¶ï¼Œprint() è¯­å¥ä¼šäº¤é”™è¾“å‡º
2. **Novel Summary æ—¥å¿—ç©¿æ’**ï¼š`_update_novel_summary` åœ¨æ¯ä¸ªsubtaskå®Œæˆåéƒ½ä¼šæ‰§è¡Œ
3. **æ•°æ®æœ¬èº«æ··ä¹±**ï¼šworker è¾“å‡ºçš„å†…å®¹å¯èƒ½æœ¬èº«å°±åŒ…å«äº†å…¶ä»–taskçš„ä¿¡æ¯

**ä¼˜å…ˆçº§ï¼šä½** - åªæ˜¯æ—¥å¿—å¯è¯»æ€§é—®é¢˜ï¼Œä¸å½±å“åŠŸèƒ½

=== é—®é¢˜ 2: UI ä¸åŒæ­¥æ˜¾ç¤ºï¼ˆåªæ˜¾ç¤ºtask1åŠ è½½ä¸­ï¼‰===
è¡¨ç°ï¼šUIåªæ˜¾ç¤ºtask1å¤„äº"åŠ è½½ä¸­"çŠ¶æ€ï¼Œæ²¡æœ‰åŒæ­¥æ›´æ–°åç»­taskçš„çŠ¶æ€

**è¿™æ˜¯é—®é¢˜3çš„ç—‡çŠ¶è¡¨ç°**

=== é—®é¢˜ 3: UIå†…å®¹å®Œå…¨æ— æ³•æ˜¾ç¤ºåˆ°å‰ç«¯ âš ï¸ ===

**æ ¹æœ¬åŸå› **ï¼šorchestrator_state.worker_outputs ç¼“å­˜æœªæ­£ç¡®æ›´æ–°

ä»logåˆ†æï¼š
- ç¬¬38è¡Œï¼š`[Snapshot] Found 0 SUBTASK_RESULT envelopes`
- ç¬¬39è¡Œï¼š`[Snapshot] Final worker_outputs count: 0 (expected: 4)`
- ä½†ç¬¬46-48è¡Œï¼š`âœ“ SUBTASK_RESULT envelope sent for t1`ã€`âœ“ Envelope log exists with 1 SUBTASK_RESULT entries`

è¯´æ˜ï¼š
- SUBTASK_RESULT ç¡®å®å†™å…¥äº† envelopes.jsonl
- ä½†åœ¨ç”Ÿæˆsnapshotæ—¶ï¼Œè¯»å–åˆ°çš„æ˜¯ 0 ä¸ª SUBTASK_RESULT
- **æ—¶åºç«äº‰**ï¼šsnapshot åœ¨ 17:30:49 ç”Ÿæˆï¼Œenvelope ä¹Ÿåœ¨ 17:30:49 å†™å…¥ï¼ˆåŒä¸€ç§’ï¼‰

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” æ·±å±‚æŠ€æœ¯åˆ†æ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

=== æ— æ³•è§£å†³æ ¹æœ¬é—®é¢˜çš„æ–¹æ¡ˆ ===

âŒ **ä»…åœ¨UIå±‚æ·»åŠ timelineæ˜¾ç¤ºæ˜¯ä¸å¤Ÿçš„**

å³ä½¿æ·»åŠ äº† ProgressEventTimeline ç»„ä»¶ï¼ˆApp.tsx:3789-3834ï¼‰ï¼Œå¦‚æœåç«¯æ ¹æœ¬ä¸è¿”å› progress_eventsï¼ŒUIå±‚ä¾æ—§æ˜¯ç©ºç™½ã€‚

å…³é”®é—®é¢˜é“¾æ¡ï¼š
1. api.py:219-252 çš„ _load_progress_events åœ¨ä»¥ä¸‹æƒ…å†µè¿”å›ç©ºæ•°ç»„ï¼š
   - çŠ¶æ€æ–‡ä»¶ä¸¢å¤±ï¼ˆFileNotFoundErrorï¼‰
   - progress_events.jsonl æ–‡ä»¶ä¸å­˜åœ¨
   - since æ—¶é—´æˆ³è¿‡æ»¤å¯¼è‡´æ‰€æœ‰äº‹ä»¶è¢«æ’é™¤
   - orchestrator_state.progress_events ä¸ºç©º

2. å¦‚æœ GET /sessions/{id} å› ä¸º SessionSnapshotModel æ ¡éªŒå¤±è´¥ï¼ˆå¦‚æ—§ç‰ˆæ‹’ç» agent="planner"ï¼‰ï¼Œ
   æ ¹æœ¬æ‹¿ä¸åˆ° snapshotï¼Œtimeline ä¹Ÿæ°¸æ— æœºä¼šæ˜¾ç¤º

**ç»“è®º**ï¼šUIå±‚çš„æ”¹åŠ¨ä¸èƒ½æ›¿ä»£ API è¯·æ±‚é“¾è·¯ä¸­æ–­çš„é—®é¢˜

=== å…³é”®ä»£ç ä½ç½®ä¸é—®é¢˜ ===

1. **Envelope å†™å…¥ç¼ºå°‘ flush()**
   ä½ç½®ï¼šmulti_agent_platform/message_bus.py:64-67
   ```python
   with log_path.open("a", encoding="utf-8") as f:
       f.write(json.dumps(envelope_dict, ensure_ascii=False))
       f.write("\n")
   # ç¼ºå°‘ f.flush() æˆ– os.fsync(f.fileno())
   ```

2. **Events æ¥å£å®Œå…¨ä¾èµ–ç¼“å­˜**
   ä½ç½®ï¼šapi.py:278-298 _load_worker_outputs_since
   ```python
   def _load_worker_outputs_since(session_id: str, since: Optional[datetime]) -> list[dict]:
       outputs: list[dict] = []
       try:
           state = orch.load_orchestrator_state(session_id)
       except FileNotFoundError:
           return outputs  # æ–‡ä»¶ä¸¢å¤±ç›´æ¥è¿”å›ç©ºï¼
       for wo in state.worker_outputs or []:
           # ... åªå¤„ç†ç¼“å­˜æ•°æ®
   ```

   **å…³é”®å‘ç°**ï¼šè¿™ä¸ªå‡½æ•°å®Œå…¨ä¾èµ– orchestrator_state.worker_outputs ç¼“å­˜ï¼
   å¦‚æœç¼“å­˜ä¸ºç©ºæˆ–æ–‡ä»¶ä¸¢å¤±ï¼Œå³ä½¿ envelope å†™å…¥æˆåŠŸï¼Œeventsæ¥å£ä¹Ÿè¿”å›ç©ºæ•°ç»„ã€‚

3. **Progress Events è¯»å–é€»è¾‘**
   ä½ç½®ï¼šapi.py:219-252 _load_progress_events
   é—®é¢˜ï¼š
   - åœ¨çŠ¶æ€ä¸¢å¤±æ—¶è¿”å›ç©ºæ•°ç»„
   - since æ—¶é—´æˆ³è¿‡æ»¤å¯èƒ½è¿‡æ»¤æ‰æ‰€æœ‰äº‹ä»¶
   - æ²¡æœ‰ä» envelope.jsonl ä¸­è¡¥å……ç¼ºå¤±çš„ progress_events

4. **SessionSnapshotModel éªŒè¯é—®é¢˜**
   ä½ç½®ï¼šmulti_agent_platform/api_models.py:53-60
   å¦‚æœæ¨¡å‹éªŒè¯å¤±è´¥ï¼ˆå¦‚ agent å­—æ®µå€¼ä¸åœ¨æšä¸¾èŒƒå›´å†…ï¼‰ï¼Œæ•´ä¸ªè¯·æ±‚éƒ½ä¼šå¤±è´¥

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… å¿…é¡»ä¿®å¤çš„æ ¹æœ¬é—®é¢˜ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰æ¯æ¬¡å®Œæˆè¯·commit åˆ°github
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Phase 1: æ•°æ®æŒä¹…åŒ–ä¸è¯»å–ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰âœ… å·²å®Œæˆ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

- [x] 1.1 ç¡®ä¿ envelope å†™å…¥æ—¶ flush åˆ°ç£ç›˜
      ä½ç½®ï¼šmulti_agent_platform/message_bus.py:64-67
      æ–¹æ¡ˆï¼šåœ¨ f.write("\n") åæ·»åŠ  f.flush() å’Œ os.fsync(f.fileno())

- [x] 1.2 ç¡®ä¿ orchestrator_state ä¿å­˜æ—¶ flush
      ä½ç½®ï¼šrun_flow.py save_orchestrator_state() è°ƒç”¨å¤„
      æ–¹æ¡ˆï¼šä¿å­˜åç¡®ä¿æ–‡ä»¶å®Œå…¨å†™å…¥ç£ç›˜
      âœ… å·²å®Œæˆ - commit 0a273dc

- [x] 1.3 ä¿®å¤ _load_worker_outputs_since çš„å®¹é”™æœºåˆ¶
      ä½ç½®ï¼šapi.py:278-298
      æ–¹æ¡ˆï¼šå½“ç¼“å­˜ä¸ºç©ºæ—¶ï¼Œå°è¯•ä» envelopes.jsonl è¯»å– SUBTASK_RESULT
      å®ç°ï¼šå¤ç”¨ build_session_snapshot ä¸­çš„ envelope è§£æé€»è¾‘
      âœ… å·²å®Œæˆ - commit 2f5c23b (æœ€å…³é”®çš„ä¿®å¤)

- [x] 1.4 ä¿®å¤ _load_progress_events çš„æ•°æ®æº
      ä½ç½®ï¼šapi.py:219-252
      å½“å‰é—®é¢˜ï¼šåªè¯»å–å†…å­˜çŠ¶æ€ + progress_events.jsonl
      æ–¹æ¡ˆï¼šå¦‚æœè¿™ä¸¤ä¸ªéƒ½ä¸ºç©ºï¼Œå°è¯•ä» envelopes.jsonl ä¸­æå–è¿›åº¦äº‹ä»¶
      âœ… å·²å®Œæˆ - commit 80f286e

- [x] 1.5 ä¿®å¤ SessionSnapshotModel éªŒè¯è§„åˆ™
      ä½ç½®ï¼šmulti_agent_platform/api_models.py:53-60
      æ–¹æ¡ˆï¼šå…è®¸ agent å­—æ®µæœ‰æ›´å®½æ¾çš„å€¼ï¼ˆå¦‚ "planner"ï¼‰
      æˆ–è€…ï¼šåœ¨ä¿å­˜å‰è§„èŒƒåŒ–æ•°æ®ï¼Œç¡®ä¿ç¬¦åˆæ¨¡å‹çº¦æŸ
      âœ… å·²å®Œæˆ - commit 0a273dc

Phase 2: UI å±‚ä¼˜åŒ–ï¼ˆä¾èµ– Phase 1 å®Œæˆï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

- [ ] 2.1 buildProgressTimelineEntries æ—¶é—´æˆ³æ’åºä¿®å¤ âš ï¸ é«˜ä¼˜å…ˆçº§
      ä½ç½®ï¼šApp.tsx:717-749

      **å½“å‰é—®é¢˜**ï¼š
      - ä»…åŸºäº ts æ’åºï¼Œç¼ºå¤±æ—¶é—´æˆ³çš„äº‹ä»¶é»˜è®¤ä¸º 0ï¼Œè·³åˆ°æ—¶é—´çº¿æœ€å‰é¢
      - æ— æ³•ä¿ç•™åç«¯æ—¥å¿—çš„å®é™…å†™å…¥é¡ºåº
      - redo/decision äº‹ä»¶å¯èƒ½è¢«ä»»æ„é‡æ’ï¼Œç ´åå› æœå…³ç³»

      **ä¿®å¤æ–¹æ¡ˆ**ï¼š
      åœ¨æ¯”è¾ƒæ—¶é—´æˆ³å‰ï¼Œå…ˆä½¿ç”¨åŸå§‹æ’å…¥ç´¢å¼•ï¼ˆæˆ– payload.sequenceï¼‰ä½œä¸º fallback

      ```tsx
      // buildProgressTimelineEntries ä¿®æ”¹
      const rawEvents = snapshot?.progress_events || [];

      // ä¸ºæ¯ä¸ªäº‹ä»¶æ·»åŠ åŸå§‹ç´¢å¼•
      const eventsWithIndex = rawEvents.map((ev, idx) => ({
          ...ev,
          _originalIndex: idx
      }));

      // è¿‡æ»¤ç‰¹å®š agent çš„äº‹ä»¶...

      // æ’åºï¼šä¼˜å…ˆä½¿ç”¨æ—¶é—´æˆ³ï¼Œç¼ºå¤±æ—¶ç”¨åŸå§‹ç´¢å¼•
      entries.sort((a, b) => {
          const tsA = a.ts ? new Date(a.ts).getTime() : null;
          const tsB = b.ts ? new Date(b.ts).getTime() : null;

          // ä¸¤è€…éƒ½æœ‰æ—¶é—´æˆ³ï¼šæŒ‰æ—¶é—´æˆ³æ’åº
          if (tsA !== null && tsB !== null) {
              if (tsA !== tsB) return tsA - tsB;
              // æ—¶é—´æˆ³ç›¸åŒï¼šç”¨åŸå§‹ç´¢å¼•æ‰“ç ´å¹³å±€
              return (a._originalIndex || 0) - (b._originalIndex || 0);
          }

          // åªæœ‰ä¸€ä¸ªæœ‰æ—¶é—´æˆ³ï¼šæœ‰æ—¶é—´æˆ³çš„æ’åé¢ï¼ˆä¿æŒæ— æ—¶é—´æˆ³çš„åŸå§‹é¡ºåºï¼‰
          if (tsA === null && tsB !== null) return -1;
          if (tsA !== null && tsB === null) return 1;

          // éƒ½æ²¡æœ‰æ—¶é—´æˆ³ï¼šä¿æŒåŸå§‹ç´¢å¼•é¡ºåº
          return (a._originalIndex || 0) - (b._originalIndex || 0);
      });
      ```

- [ ] 2.2 ProgressEventTimeline è§†è§‰ä¼˜åŒ–ä¸ä¿¡æ¯å®Œæ•´æ€§ âš ï¸ é«˜ä¼˜å…ˆçº§
      ä½ç½®ï¼šApp.tsx:3789-3844

      **å½“å‰é—®é¢˜**ï¼š
      - stage/status/metadata æŒ¤åœ¨ä¸€åˆ—ï¼Œéš¾ä»¥æ‰«æå…³é”®ä¿¡æ¯
      - ç¼ºå°‘ REDO/ACCEPT å†³ç­–çš„è§†è§‰åŒºåˆ†
      - æœªæ˜¾ç¤º subtaskId æˆ– task orderï¼Œç”¨æˆ·çœ‹åˆ° "Novel Summary timeline" æ— æ³•å®šä½å…·ä½“ä»»åŠ¡

      **æ”¹è¿›æ–¹æ¡ˆ**ï¼š

      1. æ·»åŠ å†³ç­–ç±»å‹å¾½ç« ï¼ˆbadgeï¼‰ï¼š
      ```tsx
      const decisionBadge = (decision: string) => {
          const styles = {
              REDO: { bg: "#fee2e2", fg: "#991b1b", label: "REDO" },
              ACCEPT: { bg: "#d1fae5", fg: "#065f46", label: "ACCEPT" },
              PENDING: { bg: "#f3f4f6", fg: "#4b5563", label: "PENDING" }
          };
          const style = styles[decision] || styles.PENDING;
          return (
              <span style={{
                  background: style.bg,
                  color: style.fg,
                  padding: "2px 8px",
                  borderRadius: "4px",
                  fontSize: "11px",
                  fontWeight: "700"
              }}>
                  {style.label}
              </span>
          );
      };
      ```

      2. æ˜¾ç¤ºä»»åŠ¡ä¿¡æ¯ï¼ˆTask ID + Orderï¼‰ï¼š
      ```tsx
      // åœ¨ ProgressEventTimeline ç»„ä»¶ä¸­
      {entries.map((entry, idx) => {
          const subtaskId = entry.subtask_id || entry.payload?.subtask_id;
          const taskOrder = subtaskMap.get(subtaskId);  // ä» snapshot.subtasks è·å– order

          return (
              <div key={idx} style={{ ... }}>
                  <div style={{ display: "flex", alignItems: "center", gap: "8px" }}>
                      {taskOrder && (
                          <span style={{
                              fontWeight: "700",
                              color: "#6b7280",
                              fontSize: "12px"
                          }}>
                              Task {taskOrder}
                          </span>
                      )}
                      <span>Â·</span>
                      {entry.payload?.decision && decisionBadge(entry.payload.decision)}
                      <span style={{ fontSize: "13px" }}>by {entry.agent}</span>
                  </div>
                  <div>{entry.title || subtaskId}</div>
              </div>
          );
      })}
      ```

      **æœŸæœ›æ•ˆæœ**ï¼š
      æ˜¾ç¤º "Task 1 Â· REDO by reviewer" è€Œä¸æ˜¯ "Novel Summary timeline"

- [ ] 2.3 ä¼˜åŒ– timeline entries çš„ä¾èµ–ä¸æ€§èƒ½ âš ï¸ ä¸­ä¼˜å…ˆçº§
      ä½ç½®ï¼šApp.tsx:4071, 4309

      **å½“å‰é—®é¢˜**ï¼š
      - workerTimelineEntries å’Œ reviewerTimelineEntries ä¾èµ–æ•´ä¸ª snapshot å¯¹è±¡
      - æ¯æ¬¡ snapshot ä»»ä½•éƒ¨åˆ†æ›´æ–°ï¼ˆå¦‚ is_running å˜åŒ–ï¼‰éƒ½ä¼šé‡å»ºæ•°ç»„
      - åœ¨é•¿æ—¶é—´è¿è¡Œçš„ session ä¸­é€ æˆä¸å¿…è¦çš„æ¸²æŸ“å¼€é”€

      **ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
      ç²¾ç¡®æŒ‡å®šä¾èµ–é¡¹ï¼Œåªåœ¨ç›¸å…³æ•°æ®å˜åŒ–æ—¶é‡å»º

      ```tsx
      // WorkerColumn ç»„ä»¶ä¸­
      const workerTimelineEntries = useMemo(
          () => buildProgressTimelineEntries(snapshot, "worker"),
          [
              snapshot?.progress_events,      // äº‹ä»¶åˆ—è¡¨å˜åŒ–
              snapshot?.subtasks              // ä»»åŠ¡æ ‡é¢˜å˜åŒ–æ—¶ä¹Ÿéœ€è¦é‡å»ºï¼ˆæ˜¾ç¤ºåç§°ï¼‰
          ]
      );

      // CoordinatorColumn ç»„ä»¶ä¸­
      const reviewerTimelineEntries = useMemo(
          () => buildProgressTimelineEntries(snapshot, "reviewer"),
          [
              snapshot?.progress_events,
              snapshot?.subtasks
          ]
      );
      ```

      **æ€§èƒ½æå‡**ï¼š
      é¿å…åœ¨ is_runningã€current_subtask_id ç­‰æ— å…³å­—æ®µå˜åŒ–æ—¶é‡å»ºæ—¶é—´çº¿æ•°ç»„

- [ ] 2.4 ä¿®å¤å‰ç«¯äº‹ä»¶è½®è¯¢åœæ­¢è¿‡æ—©çš„é—®é¢˜
      ä½ç½®ï¼šApp.tsx:992-1003
      æ–¹æ¡ˆï¼šåœ¨æ‰€æœ‰ subtask å®Œæˆå‰ä¿æŒè½®è¯¢ï¼Œä¸ä»…ä¾èµ– is_running

- [ ] 2.5 ä¿®å¤ mergeSnapshotWithEvents åˆå¹¶é€»è¾‘
      ä½ç½®ï¼šApp.tsx:764-817
      æ–¹æ¡ˆï¼šç¡®ä¿æ–°çš„ worker_outputs æ­£ç¡®åˆå¹¶ï¼Œä¸è¢«å»é‡é€»è¾‘é”™è¯¯è¿‡æ»¤

Phase 3: Redo ç‰ˆæœ¬æ”¯æŒï¼ˆå¯é€‰åŠŸèƒ½å¢å¼ºï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

- [ ] 3.1 åœ¨ worker_outputs ä¸­æ·»åŠ  revision å­—æ®µ
      åç«¯ï¼šrun_flow.py å‘é€ SUBTASK_RESULT æ—¶æ·»åŠ  revision å­—æ®µ

- [ ] 3.2 UI æ¸²æŸ“åŒä¸€ subtask_id çš„å¤šä¸ªç‰ˆæœ¬
      ä½ç½®ï¼šApp.tsx WorkerColumn
      æ–¹æ¡ˆï¼šæŒ‰ subtask_id åˆ†ç»„ï¼ŒåŒä¸€ä¸ªtaskçš„å¤šä¸ªç‰ˆæœ¬å †å æ˜¾ç¤º
      ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼šæ­£å¸¸æ˜¾ç¤º
      åç»­ç‰ˆæœ¬ï¼šæ˜¾ç¤º "[Redone Version]" æ ‡ç­¾

- [ ] 3.3 Reviewer timeline è®°å½• REDO äº‹ä»¶
      æ–¹æ¡ˆï¼šåœ¨å‘é€ REQUEST_REDO æ—¶è®°å½•ä¸º progress_event
      åç«¯ï¼šrun_flow.py å‘é€ orch_events æ—¶åŒæ—¶è®°å½•åˆ° progress_events

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š å®Œæ•´çš„é—®é¢˜é“¾æ¡
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. ç”¨æˆ·æ‰§è¡Œ "all" å‘½ä»¤ â†’ execute_command() å¯åŠ¨åå°ä»»åŠ¡
2. åå°ä»»åŠ¡æ‰§è¡Œ worker â†’ å†™å…¥ envelope â†’ æ›´æ–° state.worker_outputs â†’ save_orchestrator_state()
   âš ï¸ é—®é¢˜ç‚¹ï¼šsave å¯èƒ½æœª flushï¼Œenvelope å¯èƒ½æœª flush
3. å‰ç«¯è½®è¯¢ /events æ¥å£ â†’ _load_worker_outputs_since() è¯»å– orchestrator_state
   âš ï¸ é—®é¢˜ç‚¹ï¼šåªè¯»ç¼“å­˜ï¼Œå¦‚æœ FileNotFoundError ç›´æ¥è¿”å›ç©ºæ•°ç»„
4. å‰ç«¯æ”¶åˆ°ç©ºæ•°ç»„ â†’ UI æ— æ³•æ˜¾ç¤ºä»»ä½•å†…å®¹

**ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿ**ï¼š
- åå°ä»»åŠ¡æ˜¯å¼‚æ­¥çš„ï¼Œstate.worker_outputs çš„æ›´æ–°æœ‰å»¶è¿Ÿ
- save_orchestrator_state() å’Œ envelope å†™å…¥éƒ½æ²¡æœ‰ flush
- load_orchestrator_state() è¯»å–æ—¶å¯èƒ½è¯»åˆ°æ—§æ•°æ®æˆ–æ‰¾ä¸åˆ°æ–‡ä»¶
- events æ¥å£æ²¡æœ‰å®¹é”™æœºåˆ¶ï¼ˆç¼“å­˜å¤±è´¥æ—¶ä¸å°è¯•ä» envelope è¯»å–ï¼‰

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ å®æ–½å»ºè®®
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

**ç«‹å³æ‰§è¡Œï¼ˆå…³é”®è·¯å¾„ï¼‰**ï¼š
1. Phase 1.1 - 1.2ï¼šä¿®å¤æ–‡ä»¶ flush é—®é¢˜ï¼ˆæœ€ç®€å•ï¼Œå½±å“æœ€å¤§ï¼‰
2. Phase 1.3 - 1.4ï¼šä¿®å¤ events æ¥å£å®¹é”™ï¼ˆç¡®ä¿å³ä½¿ç¼“å­˜å¤±è´¥ä¹Ÿèƒ½ä» envelope è¯»å–ï¼‰
3. Phase 1.5ï¼šä¿®å¤æ¨¡å‹éªŒè¯ï¼ˆæ¸…ç† API éªŒè¯æ ¼å±€ï¼‰

**éªŒè¯æµ‹è¯•**ï¼š
1. å¯åŠ¨åå°ä»»åŠ¡åï¼Œç«‹å³è°ƒç”¨ /events æ¥å£ï¼Œæ£€æŸ¥æ˜¯å¦èƒ½è·å– worker_outputs
2. åˆ é™¤ orchestrator_state æ–‡ä»¶ï¼Œæ£€æŸ¥ events æ¥å£æ˜¯å¦èƒ½ä» envelope è¯»å–æ•°æ®
3. æ£€æŸ¥ progress_events æ˜¯å¦æ­£ç¡®å†™å…¥å¹¶é€å‡º

**åç»­ä¼˜åŒ–ï¼ˆPhase 2-3ï¼‰**ï¼š
åœ¨ Phase 1 å…¨éƒ¨å®Œæˆå¹¶éªŒè¯é€šè¿‡åï¼Œå†è¿›è¡Œ UI å±‚ä¼˜åŒ–å’ŒåŠŸèƒ½å¢å¼ºã€‚

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ Redoç‰ˆæœ¬æ˜¾ç¤ºç¤ºä¾‹ï¼ˆPhase 3 å‚è€ƒï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

åç«¯æ•°æ®ç»“æ„ï¼ˆworker_outputsï¼‰ï¼š
```json
[
  {
    "subtask_id": "t1",
    "subtask_title": "Research",
    "content": "ç¬¬ä¸€ç‰ˆå†…å®¹...",
    "timestamp": "2025-12-10T17:30:49",
    "revision": 0
  },
  {
    "subtask_id": "t1",
    "subtask_title": "Research",
    "content": "ä¿®æ”¹åçš„å†…å®¹...",
    "timestamp": "2025-12-10T17:35:20",
    "revision": 1
  }
]
```

å‰ç«¯æ¸²æŸ“é€»è¾‘ï¼ˆWorkerColumnï¼‰ï¼š
```tsx
// æŒ‰ subtask_id åˆ†ç»„
const groupedOutputs = outputs.reduce((acc, out) => {
  if (!acc[out.subtask_id]) acc[out.subtask_id] = [];
  acc[out.subtask_id].push(out);
  return acc;
}, {});

// æ¸²æŸ“æ—¶
Object.entries(groupedOutputs).map(([subtaskId, versions]) => (
  <div key={subtaskId}>
    <h3>{versions[0].subtask_title}</h3>
    {versions.map((version, idx) => (
      <div key={idx}>
        {idx > 0 && <span className="redo-badge">[Redone Version {idx}]</span>}
        <p>{version.content}</p>
      </div>
    ))}
  </div>
))
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”§ æœ€æ–° Review Findingsï¼ˆ2025-12-10ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

**çŠ¶æ€**ï¼šâœ… æ— é˜»å¡é—®é¢˜ï¼Œä½†å»ºè®®è¿›è¡Œä»¥ä¸‹ä¼˜åŒ–ä»¥ä¿æŒ timeline UI å¯é å’Œå¯è¯»

### ä¼˜åŒ– 1ï¼šæ—¶é—´æˆ³æ’åºé€»è¾‘ä¿®å¤ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
**ä½ç½®**ï¼šbuildProgressTimelineEntries (App.tsx:717-749)

**ç°çŠ¶**ï¼š
- ä»…åŸºäº ts æ’åºï¼Œç¼ºå¤±æ—¶é—´æˆ³çš„äº‹ä»¶é»˜è®¤ä¸º 0
- è¿™äº›äº‹ä»¶ä¼šè·³åˆ°æ—¶é—´çº¿æœ€å‰é¢
- æ— æ³•ä¿ç•™åç«¯æ—¥å¿—çš„å®é™…å†™å…¥é¡ºåºï¼ˆchronological orderï¼‰
- redo/decision äº‹ä»¶å¯èƒ½è¢«ä»»æ„é‡æ’

**å½±å“**ï¼š
ç ´åäº‹ä»¶çš„å› æœå…³ç³»ï¼Œç”¨æˆ·æ— æ³•ç†è§£æ­£ç¡®çš„æ‰§è¡Œæµç¨‹

**è§£å†³æ–¹æ¡ˆ**ï¼š
å‚è§ Phase 2.1 çš„è¯¦ç»†å®ç°ä»£ç 

---

### ä¼˜åŒ– 2ï¼šTimeline å¡ç‰‡ä¿¡æ¯å®Œæ•´æ€§ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
**ä½ç½®**ï¼šProgressEventTimeline (App.tsx:3789-3844)

**ç°çŠ¶**ï¼š
- stage/status/metadata æŒ¤åœ¨å•åˆ—
- reviewer åé¦ˆå…³é”®ä¿¡æ¯ï¼ˆtask id + decisionï¼‰éš¾ä»¥æ‰«æ
- ç¼ºå°‘ REDO/ACCEPT çš„è§†è§‰åŒºåˆ†
- æ²¡æœ‰æ˜¾ç¤º subtaskId æˆ–ä»»åŠ¡é¡ºåº

**å½±å“**ï¼š
ç”¨æˆ·çœ‹åˆ° "Novel Summary timeline" æ— æ³•å®šä½å…·ä½“æ˜¯å“ªä¸ªä»»åŠ¡

**æœŸæœ›æ•ˆæœ**ï¼š
æ˜¾ç¤º "Task 1 Â· REDO by reviewer" ä»£æ›¿æ¨¡ç³Šæè¿°

**è§£å†³æ–¹æ¡ˆ**ï¼š
å‚è§ Phase 2.2 çš„ badge è®¾è®¡å’Œä»»åŠ¡ä¿¡æ¯æ˜¾ç¤ºä»£ç 

---

### ä¼˜åŒ– 3ï¼šæ€§èƒ½ä¼˜åŒ–ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
**ä½ç½®**ï¼šworkerTimelineEntries / reviewerTimelineEntries (App.tsx:4071, 4309)

**ç°çŠ¶**ï¼š
- ä¾èµ–æ•´ä¸ª snapshot å¯¹è±¡
- snapshot ä»»ä½•éƒ¨åˆ†æ›´æ–°éƒ½ä¼šé‡å»ºæ•°ç»„
- é•¿æ—¶é—´è¿è¡Œçš„ session ä¸­é€ æˆä¸å¿…è¦çš„æ¸²æŸ“

**è§£å†³æ–¹æ¡ˆ**ï¼š
ç²¾ç¡®ä¾èµ– `snapshot.progress_events` å’Œ `snapshot.subtasks`

---

**æ€»ç»“**ï¼š
è¿™ä¸‰é¡¹ä¼˜åŒ–ä¸ä¼šé˜»å¡åŠŸèƒ½ï¼Œä½†èƒ½æ˜¾è‘—æå‡ timeline UI çš„å¯é æ€§å’Œå¯è¯»æ€§ã€‚
å»ºè®®åœ¨ Phase 1 å®Œæˆåï¼Œä¼˜å…ˆå®æ–½ Phase 2.1 å’Œ 2.2ã€‚

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

å½“å‰logå‚è€ƒï¼š
\n=== Subtask t1: Research ===
INFO:     100.64.0.2:16526 - "POST /sessions/sess-20251210-222943-cffaf1a8/command HTTP/1.1" 200 OK
[Snapshot] Envelope log path: /app/multi_agent_platform/sessions/sess-20251210-222943-cffaf1a8/logs/envelopes.jsonl
[Snapshot] Log file exists: True
[Snapshot] Processing 5 envelopes for session sess-20251210-222943-cffaf1a8
[Snapshot] Found 0 SUBTASK_RESULT envelopes
[Snapshot] Final worker_outputs count: 0 (expected: 4)
...
  Worker result saved: sessions/sess-20251210-222943-cffaf1a8/artifacts/9ec0289e1d11.md
  Worker output length: 276 chars
  Sending SUBTASK_RESULT for t1
  âœ“ SUBTASK_RESULT envelope sent for t1
  âœ“ Envelope log exists with 1 SUBTASK_RESULT entries
  Cached output on subtask t1
